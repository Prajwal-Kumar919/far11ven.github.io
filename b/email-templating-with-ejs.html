<!DOCTYPE html>
<html lang="en">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
      <title>blog - Email Templating with EJS (Node + Express + SendGrid)</title>
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <script src="../index.js"></script>
      <script src="pace.js"></script>
      <link rel="icon" type="image/x-icon" href="../favicon.ico">
      <link rel="stylesheet" href="../style.css">
      <link rel="stylesheet" href="style.css">
      <link rel="stylesheet" href="togglestyle.css" />
      <link rel="stylesheet" href="pace.css">
      <meta name="keywords" content="kushal bhalaik">
      <meta name="description" content="Knowing Me">
      <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css"
         integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
      <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Quicksand" />
      <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
         integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
      <meta property="og:url" content="http://www.kushalbhalaik.xyz">
      <meta property="og:type" content="website">
      <meta property="og:title" content="blog - Email Templating with EJS (Node + Express + SendGrid)">
      <meta property="og:description" content="Email Templating with EJS (Node + Express + SendGrid)">
      <meta property="og:image" content="/assets/logo.png">
      <meta name="keywords" content="ejs, SendGrid, Email templating, node.js">
   <body>
      <nav class="navbar navbar-expand-lg navbar-light fixed-top">
         <a class="navbar-brand" href="/">kushalbhalaik.xyz</a>
         <button class="navbar-toggler dark-th" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
         <span class="navbar-toggler-icon dark-th"></span>
         </button>
         <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">
               <li class="nav-item header">
                  <a class="nav-link dark-th" href="https://blog.kushalbhalaik.xyz"> blog </a>
               </li>
               <li class="nav-item header">
                  <a class="nav-link dark-th" href="/my-work.html"> my work </a>
               </li>
               <li class="nav-item header">
                  <a class="nav-link dark-th" href="/contact.html"> contact me </a>
               </li>
            </ul>
         </div>
         </div>
      </nav>
      <div class="container">
         <div class="post-image">
            <div class="card">
               <img src="https://cdn-images-1.medium.com/max/12032/1*MM2L7g1BEHa8ski3RCAM5A.jpeg" alt="medium_image_1.png"/>
            </div>
         </div>
         <div class="container">
            <div class="row">
               <div class="post">
                  <div class="post-head">
                     <h1 class="display-4"> Email Templating with EJS (Node + Express + SendGrid)</h1>
                     <span class="post-date text-muted">December 26, 2019</span>
                     <hr>
                     <div class="post-body">
                        <p>I’ve been building a social links website <a href="https://www.8link.in/?ref=blog">8link</a>, 
                           which requires me to interact with my users at different levels. 
                           So the type of email interaction with my users, I’ve narrowed it down to the following categories of emails:
                        </p>
                        <ol>
                           <li>
                              Welcome email (With verify link)
                           </li>
                           <br>
                           <li>
                              Password reset link
                           </li>
                           <br>
                           <li>
                              Automated response to user queries
                           </li>
                           <br>
                           <li>
                              The actual response to User queries
                           </li>
                           <br>
                           <li>
                              Occasional promo or newsletters
                           </li>
                           <br>
                        </ol>
                        <p>I’ve been using a Node.js +Express back-end and I wanted to achieve it with same frame-work. So I started using SendGrid <a href="https://sendgrid.com/solutions/email-api/">Email API</a> to achieve this goal.</p>
                        <blockquote>
                           <p>SendGrid already has a Templating service, if you are interested you can check it <a href="https://sendgrid.com/docs/ui/sending-email/how-to-send-an-email-with-dynamic-transactional-templates/">here</a>.</p>
                        </blockquote>
                        <p>Back to Templating with EJS,
                           in This article, we’ll see how can we create Re-Usable HTML Templates with EJS and then deliver them with SendGrid.
                        </p>
                        <p>We’ll start by creating a simple node project:</p>
                        <pre><code>

                              npm init sendgrid-mailer

                           </code></pre>
                        <p>Install following dependencies,</p>
                        <pre><code>

                              npm i --save express cors ejs

                           </code></pre>
                        <p>Our Package.json should look like:</p>
                        <p><img alt="package.json file" src="https://cdn-images-1.medium.com/max/1792/1*4KnnrY1HX6LCh8S7djHtNw.png"></p>
                        <hr>
                        <p>Let’s create a simple endpoint to serve our email “/hello”</p>
                        <pre><code>

                              //set express view engine to ejs

                              app.set(“view engine”, “ejs”);

                           </code></pre>
                        <div><iframe width="0" height="0" src="" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
                        <p>it should give us the following response:</p>
                        <p><img alt="/hello on localhost" src="https://cdn-images-1.medium.com/max/960/1*bX6CnP-NNwnBN1Rxuh6v2w.png"></p>
                        <p>We are halfway there, Now create a <em>welcome-mail.ejs</em> file in views (Template) folder in the project root directory.</p>
                        <p><img src="https://cdn-images-1.medium.com/max/798/1*0dtPUAeab8tupUAwxjKfLg.png"></p>
                        <p>Now add some HTML code in there, which will serve as an underlying template for our welcome mail:</p>
                        <div><iframe width="0" height="0" src="" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
                        <p>You will see the following syntax in this HTML, which is used to receive data before rendering it. We are using the following variables for manipulating data:</p>
                        <pre><code>

                              //these are EJS expressions to dynamically receive and display data while rendering an HTML

                                 &lt;%= user_firstname %&gt;

                                 &lt;%= confirm_link %&gt;

                           </code></pre>
                        <p>Now we need to make changes to our “/hello” endpoint</p>
                        <p>We’ll need to import following to our index.js file:</p>
                        <pre><code>

                              //imports

                              const path = require(“path”);

                              const ejs = require(“ejs”);

                           </code></pre>
                        <p>and our “/hello” app route function will change to :</p>
                        <pre><code>

                              app.get(“/hello”, (*req*, *res*, *next*) => {

                                 let emailTemplate;

                                 let capitalizedFirstName = “John”;

                                 let userEmail = “John @example.com”;

                                 

                                 ejs

                                 .renderFile(path.join(__dirname, “views / welcome - mail.ejs”), {

                                    user_firstname: capitalizedFirstName,

                                    confirm_link: “http: //www.8link.in/confirm=" + userEmail

                                 })

                                 .then( * result * => {

                                    emailTemplate = result;

                                    res.send(emailTemplate);

                                 })

                                 .catch( * err * => {

                                    res.status(400).json({

                                       message: “Error Rendering emailTemplate”,

                                       error: err

                                    });

                                 });

                                 

                                 });

                           </code></pre>
                        <p>in here, <strong>ejs.renderFile()</strong> take .ejs file path and specify values for <strong><em>user_firstname </em></strong>and <strong><em>confirm_link</em></strong></p>
                        <p>Now if we hit “/hello” we get:</p>
                        <p><img width="100%" src="https://cdn-images-1.medium.com/max/3840/1*Y5Gtffdna1ZO_N3J-X62xQ.png"></p>
                        <p><strong>Whoops..</strong> we now have our welcome template, we just have to deliver it via email now.</p>
                        <hr>
                        <h4>Let's integrate SendGrid now:</h4>
                        <blockquote>
                           <p>First signup for SendGrid mail API, by clicking <a href="https://sendgrid.com/docs/API_Reference/api_v3.html">here</a> and get the API -KEY</p>
                        </blockquote>
                        <p>Now get @sendgrid/mail package from npm.</p>
                        <pre><code>

                              npm i --save @sendgrid/mail

                           </code></pre>
                        <p>Import following into <strong>index.js</strong></p>
                        <pre><code>

                              const SGmail = require(“@sendgrid/mail”);

                              </code
                           ></pre>
                        <p>Now in our code first register the SendGrid API Key</p>
                        <pre><code>

                              SGmail.setApiKey(process.env.SendGrid_Key);

                              //Note: store SendGrid_Key in your projects' config file

                           </code></pre>
                        <p>and replace <strong>res.send(emailTemplate); </strong>with following code:</p>
                        <pre><code>

                              const message = {

                                 to: userEmail,

                                 from: {

                                    email: “welcome @8link.in”,

                                    name: “8 link”

                                 },

                                 subject: “Welcome link”,

                                 html: emailTemplate

                              };

                              

                              return SGmail.send(message).then( * sent * => {

                              

                                 // Awesome Logic to check if mail was sent

                              

                                 res.status(200).json({

                                    message: “Welcome mail was sent”

                              

                                 });

                              

                              }).catch( * err * => {

                              

                                 console.log(“Error sending mail”, err);

                                 res.status(400).json({

                                    message: “Welcome mail was not sent”,

                                    error: err

                                 });

                              

                              });

                           </code></pre>
                        <p>Our final code should look like:</p>
                        <div><iframe width="0" height="0" src="" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
                        <p>And if I hit my “/hello” endpoint again, I should see that mail was sent successfully:</p>
                        <p><img src="https://cdn-images-1.medium.com/max/1512/1*V4fQgNhZOtrM7FzSkOEcRQ.png"></p>
                        <p>Full Code on Github: <a href="https://github.com/far11ven/SendGrid-Mailer">https://github.com/far11ven/SendGrid-Mailer</a></p>
                     </div>
                  </div>
                  <hr>
               </div>
               <hr>
               <div id="disqus_thread"></div>
            </div>
         </div>
      </div>
      <footer class="footer mt-auto p-3">
         <span class="text-muted">© 2019-20 Kushal Bhalaik</span>
      </footer>
      <script>
         /**
         
         *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
         
         *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
         
         /*
         
         var disqus_config = function () {
         
         this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
         
         this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
         
         };
         
         */
         
         (function() { // DON'T EDIT BELOW THIS LINE
         
         var d = document, s = d.createElement('script');
         
         s.src = 'https://www-kushalbhalaik-xyz.disqus.com/embed.js';
         
         s.setAttribute('data-timestamp', +new Date());
         
         (d.head || d.body).appendChild(s);
         
         })();
         
      </script>
      <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
      <script src="https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v3.2&appId=406944066536664&autoLogAppEvents=1"
         async defer crossorigin="anonymous"> </script>
      <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
         integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
         crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js"
         integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh"
         crossorigin="anonymous"></script>
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js"
         integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ"
         crossorigin="anonymous"></script>
      <!-- Go to www.addthis.com/dashboard to customize your tools -->
      <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5ca77dda4474e9f4"></script>
   </body>
</html>